var DOMINIO="https://tawi.com.pe",DIRECTORIO="",DIRECTORIO_AJAX="/ajax",SUBDOMINIO="https://static2.tawi.com.pe",IMG="/img";$(function(){var p=DOMINIO+DIRECTORIO+DIRECTORIO_AJAX+"/ajax.carrito.php",u=1,t=$("#menu-opt"),e=$("#menu-opt").outerHeight(),a=t.find("a");$(window).scroll(function(){tw_sticky(t,$(this))}),$("#restaurante-buscar").on({keyup:function(t){var i="";envia=inicaAjax(p,{origen:"buscar",patron:$("#restaurante-buscar").val()}),envia.done(function(t){$.each(t,function(t,a){i+='<div class="col-6 col-sm-4 col-md-3 pl-3 pr-0 pb-3">',i+='    <div id="'+t+'" class="card">',i+='    <a href="carta.php?id='+t+'" class="card-link">',i+='        <img class="card-img-top" alt="corazon" src="'+SUBDOMINIO+DIRECTORIO+IMG+"/restaurante/"+a.logo+'">',i+='        <div class="p-3">',i+='            <div class="card-title">'+a.nombre+"</div>",i+="        </div>",i+="    </a>",i+="    </div>",i+="</div>"}),$("#restaurante-resultado").html(i)})}}),a.on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$.attr(this,"href"),i=$(a).offset().top-e+1;$("html, body").animate({scrollTop:i},1e3)}),$(".fw-categorias").on({"show.bs.collapse":function(t){var a=t.target,i=$("#"+a.id),e=$("#"+a.id+" .tw-cantidades"),o="nivel-1"==i.prev().data("nivel")?"text-white tw-bg-a":"text-white tw-bg-b";i.prev().addClass(o),button="",parseInt(e.length)==parseInt(0)&&(button+='<div class="tw-cantidades tw-color-a d-flex justify-content-center align-items-center" data-collapse="#'+a.id+'">',button+='<i class="fas fa-minus-circle tw-fc tw-fi tw-minus"></i>',button+='<span class="fa-stack tw-fd">',button+='<span class="far fa-circle fa-stack-2x"></span>',button+='<span class="fa-stack-1x">1</span>',button+="</span>",button+='<i class="fas fa-plus-circle tw-fc tw-fi tw-plus"></i>',button+="</div>",i.find("button").before(button)),i.slideDown("slow")},"hide.bs.collapse":function(t){var a=t.target,i=$("#"+a.id),e="nivel-1"==i.prev().data("nivel")?"text-white tw-bg-a":"text-white tw-bg-b";i.prev().removeClass(e),i.slideUp("slow")}}),$(document).on("click",".tw-plus",function(){u+=1,$(this).prev().find(".fa-stack-1x").text(u),tw_action($(this),u)}),$(document).on("click",".tw-minus",function(){1<u&&(u-=1,$(this).next().find(".fa-stack-1x").text(u),tw_action($(this),u))}),$(document).on("click",".tw-plus-carrito",function(){var t=parseInt($(this).prev().text());t+=1,$(this).prev().text(t),tw_action_carrito($(this),t)}),$(document).on("click",".tw-minus-carrito",function(){var t=parseInt($(this).next().text());1<t&&(t-=1,$(this).next().text(t),tw_action_carrito($(this),t))}),$(document).on("click",".tw-delete",function(){var a=$(this).parent().parent().parent().prop("id");envia=inicaAjax(p,{origen:"delete",id:a}),envia.done(function(t){$("#"+a).parent().remove(),t.estado?$("#"+t.destino+" .tw-cantidad").text(t.cantidad):$("#"+t.destino+" .tw-cantidad").text(""),$(".tw-total").text(t.total)})}),$(document).on("click",".tw-check",function(){tw_action($(this),u);var t=$(this).parent().data("collapse"),a=$(t);obj_existe(a.prev().find(".badge"))&&a.prev().append('<span class="badge badge-success float-right p-1">agregado al pedido</span>'),a.collapse("hide")}),$(document).on("click",".tw-btn-carrito",function(){var o="",n="",r="",l=$(this).parent().parent(),t=$(this).data("precio"),s=l.prop("id"),a=l.find("input"),i=l.find("textarea").val(),c=tw_mapForm(a),e=$.makeArray(c),d={origen:"add",id:s,precio:t,cantidad:u,extras:e,plato:l.find(".tw-titulo").text(),mensaje:i};parseInt($("body #panel-lateral").length)==parseInt(0)&&(o+='<div id="panel-lateral" class="container-fluid h-100 position-fixed overflow-auto tw-fk tw-fo" data-estado="close">',o+='<div class="row h-100">',o+='<div class="col-12 col-md-3 col-lg-4 ml-auto bg-light h-100 overflow-auto">',o+='<div class="conteiner px-3">',o+='<div id="tw-container" class="row font-weight-bold">',o+='<div class="col-12 text-dark tw-fc tw-fi tw-btn-ver"><i class="fas fa-times"></i></div>',o+='<div class="col-12 tw-bg-a text-center text-white">Resumen de Pedido</div>',o+='<div class="col-12 p-0 my-3"><a class="btn btn-block tw-btn-a" href="revisar.php" role="button">CONFIRMAR</a></div>',o+="</div></div></div></div></div>",$("body").prepend(o),o=""),envia=inicaAjax(p,d),envia.done(function(t){if(t.estado){var a,i,e=t.contenido;0<c.length&&$(this).prop("disabled",!0),u=1,l.find(".fa-stack-1x").text(u),l.find("textarea").val(""),l.find(".collapse").collapse("hide"),l.find(".badge").remove(),o+='<div class="col-12 text-dark tw-fc tw-fi tw-btn-ver"><i class="fas fa-times"></i></div>',o+='<div class="col-12 tw-bg-a text-center text-white">Resumen de Pedido</div>',$.each(e.items,function(t,a){i=a.mensaje,r=a.extras,o+='<div class="col-12 border-bottom tw-bg-c my-1">',o+='<form id="'+t+'">',o+='<div class="row border-left border-right tw-bg-c">',o+='<div class="col-12 tw-color-a">'+a.plato+"</div>",o+='<div class="col-7 pr-0 tw-color-b">Precio unitario:</div>',o+='<div class="col-2 px-0 tw-color-b text-right">S/.</div>',o+='<div class="col-3 pl-0 text-right">'+a.precio+"</div>",r.estado&&(o+='<div class="col-12 tw-color-b">Extras</div>',$.each(r.contenido,function(t,a){o+='<div class="col-7 pr-0 tw-color-b"><i class="fas fa-ellipsis-h"></i> '+a.nombre+":</div>",o+='<div class="col-2 px-0 tw-color-b text-right">S/.</div>',o+='<div class="col-3 pl-0 text-right">'+a.precio+"</div>"})),o+='<div class="col-7 pr-0 mt-1 tw-color-b">Cantidad:</div>',o+='<div class="col-5 pl-0 mt-1">',o+='<div class="btn-group btn-group-sm d-flex" role="group">',o+='<button type="button" class="btn tw-btn-a tw-minus-carrito"><i class="fas fa-minus-circle"></i></button>',o+='<button type="button" class="btn tw-btn-outline-a">'+a.cantidad+"</button>",o+='<button type="button" class="btn tw-btn-a tw-plus-carrito"><i class="fas fa-plus-circle"></i></button>',o+="</div>",o+="</div>",o+='<div class="col-7 pr-0"></div>',o+='<div class="col-5 pl-0 mt-1">',o+='<div class="btn-group btn-group-sm d-flex tw-delete" role="group">',o+='<button type="button" class="btn tw-btn-outline-a">Eliminar:</button>',o+='<button type="button" class="btn tw-btn-a"><i class="far fa-trash-alt"></i></button>',o+="</div>",o+="</div>",0<i.length&&(o+='<div class="col-12 tw-color-b">Instrucciones especiales:</div>',o+='<div class="col-12">'+i+"</div>"),o+='<div class="col-7 pr-0 mb-3 tw-color-b">Total:</div>',o+='<div class="col-2 px-0 mb-3 tw-color-b text-right">S/.</div>',o+='<div class="col-3 pl-0 mb-3 text-right tw-precio">'+a.costo+"</div>",o+="</div>",o+="</form>",o+="</div>"}),a=parseInt(e.total),o+='<div class="col-12 tw-bg-a text-white tw-fj">',o+='<div class="row">',o+='<div class="col-7">TOTAL</div>',o+='<div class="col-2 text-right">S/.</div>',o+='<div class="col-3 text-right tw-total">'+a.toFixed(2)+"</div>",o+="</div>",o+="</div>",o+='<div class="col-12 p-0 my-3">',o+='<a class="btn btn-block tw-btn-a" href="revisar.php" role="button">CONFIRMAR</a></div>',o+="</div>",$("#tw-container").html(o),obj_existe($("#"+s+" .tw-cantidad"))?(n='<div class="tw-cantidad tw-fd d-flex align-items-center">'+e.contador[s]+"</div>",$("#"+s).find(".tw-subtitulo").append(n)):$("#"+s).find(".tw-cantidad").text(e.contador[s]),$("#shopping-cart").show()}})}),$(document).on("click","#tw-logeo",function(){event.preventDefault();var a,t=DOMINIO+DIRECTORIO+DIRECTORIO_AJAX+"/ajax.lib.php",i=$(this).parent().parent().prop("id"),e=$("#"+i),o=e.find(".tw-valida"),n=e.find("input"),r=tw_mapForm(n),l=tw_mapValida(o);if(e.find(".tw-valida").removeClass("is-invalid"),0==l.length){var s=$.makeArray(r);envia=inicaAjax(t,{origen:"logeo",agregado:s}),envia.done(function(t){t.estado?(obj=obj_existe($("#btn-acciones")),console.log(obj,$("#btn-acciones")),0==obj&&(a='<a class="btn tw-btn-b flex-grow-1" href="terminar.php" role="button">Confirmar</a>',$("#btn-acciones").remove(),$("#tw-accion").append(a)),a='<div class="btn-group" role="group">',a+='<button type="button" class="btn tw-btn-b">'+t.detalle.usuario+"</button>",a+='<button id="btnGroupDrop1" type="button" class="btn tw-btn-b dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>',a+='<div class="dropdown-menu" aria-labelledby="btnGroupDrop1">',a+='<a class="dropdown-item" href="cambiar.php"><i class="fas fa-key"></i>&nbsp;Cambiar contraseña</a>',a+='<a class="dropdown-item" href="historial.php"><i class="fas fa-list"></i>&nbsp;Historial de pedidos</a>',a+='<a id="tw-salir" class="dropdown-item"><i class="fas fa-sign-out-alt"></i>&nbsp;Salir</a>',a+="</div></div>",$("#tw-cabezera").find("button").remove(),$("#tw-cabezera").append(a),$("#tw-login").modal("hide")):e.find(".tw-valida").addClass("is-invalid")})}else $.each(l,function(t,a){a.addClass("is-invalid")})}),$(document).on("click","#tw-salir",function(t){t.preventDefault(),envia=inicaAjax(DOMINIO+DIRECTORIO+DIRECTORIO_AJAX+"/ajax.lib.php",{origen:"salir"}),envia.done(function(t){'<button class="btn tw-btn-b" aria-label="inicio de sesión" data-toggle="modal" data-target="#tw-login">Iniciar sesión</button>',$("#tw-cabezera").find(".btn-group").remove(),$("#tw-cabezera").append('<button class="btn tw-btn-b" aria-label="inicio de sesión" data-toggle="modal" data-target="#tw-login">Iniciar sesión</button>')})}),$(document).on("click","#tw-registra",function(){var t=$(this).parent(),a=t,i=a.find(".tw-valida"),e=a.find("input"),o=(tw_mapForm(e),tw_mapValida(i));console.log(o.length),0==o.length&&t.submit()}),$(document).on("click",".tw-btn-ver",function(){console.log("se inicia"),panel_lateral()})});var inicaAjax=function(t,a){return $.ajax({url:t,type:"POST",data:a,dataType:"json"}).fail(function(t,a){console.log("Request failed: "+a)})},tw_action=function(t,a){var i=$(t.parent().data("collapse")),e=i.find("button").data("precio");null==e&&(e=(i=$(t.parent().data("target"))).find("button").data("precio"));var o=i.find(".tw-extra").map(function(t,a){if(a.checked)return a.value}),n=parseFloat("0.00"),r=i.find("button");0<o.length&&(r.prop("disabled",!1),$.each(o,function(t,a){n+=parseFloat(a)})),console.log(o),console.log(e,n,a),sum=(parseFloat(e)+parseFloat(n))*parseFloat(a),r.html('<img class="img-fluid tw-ff" src="'+SUBDOMINIO+DIRECTORIO+IMG+'/carrito-de-compras-32.png" alt="carrito"> Agregar '+a+" al pedido S/. "+sum.toFixed(2))},tw_action_carrito=function(t,a){var i=DOMINIO+DIRECTORIO+DIRECTORIO_AJAX+"/ajax.carrito.php",e=t.parent().parent().parent().parent().prop("id");envia=inicaAjax(i,{origen:"edit",id:e,cantidad:a}),envia.done(function(t){$("#"+e+" .tw-precio").text(t.costo),$(".tw-total").text(t.total)})},tw_sticky=function(t,a){100<=a.scrollTop()?(t.addClass("fixed-top"),t.show()):(t.removeClass("fixed-top"),t.hide())},panel_lateral=function(){var t=$("#panel-lateral"),a=($("#cerrar"),"0");switch(t.data("estado")){case"close":$("body").addClass("overflow-hidden"),$("#menu-opt").hide(),t.data("estado","open"),t.find("#cerrar").removeClass("d-none");break;default:$("body").removeClass("overflow-hidden"),$("#menu-opt").show(),a="-"+t.outerWidth()+"px",t.find("#cerrar").addClass("d-none"),t.data("estado","close")}t.animate({right:a})},tw_mapForm=function(t){return t.map(function(t,a){switch(a.type){case"radio":if(valor=a.value,label=a.labels[0],a.checked)return $("#"+a.id).prop("checked",!1),{id:a.id,value:valor,nombre:label.innerText};break;case"checkbox":if(valor=a.value,a.checked)return{id:a.id,value:valor,nombre:label.innerText};break;case"select":if(val=$("#"+a.id+" option:selected").val(),0!==val)return{id:a.id,value:val};break;default:if(valor=a.value,0<valor.length)return{id:a.id,value:valor}}})},tw_mapValida=function(t){return t.map(function(t,a){switch(valor=a.value,console.log(a.type,"--\x3e",valor),a.type){case"select":if(0==valor||""!=valor)return $("#"+a.id);break;case"select-one":if(0==valor)return $("#"+a.id);break;case"radio":if(0==a.checked)return $("#"+a.id);break;default:if(0==valor.length)return $("#"+a.id)}})},timer_pedido=function(){var o=setInterval(function(){var t=DOMINIO+DIRECTORIO+DIRECTORIO_AJAX+"/ajax.lib.php",a=$("#form-pagar"),i=a.find("button").prop("id"),e="tw-completa";envia=inicaAjax(t,{origen:"verifica",id_pedido:i}),envia.done(function(t){console.log(t),t.estado&&("2"==t.valor?a.find("button").removeClass("d-none"):"4"==t.valor&&($("#"+e+" .modal-title").text("Pedido rechazado"),$("#"+e+" .modal-body").text("Su pedido ha sido rechazado."),$("#"+e).modal("show")),"2"!=t.valor&&"4"!=t.valor||clearInterval(o))})},3e3)},obj_existe=function(t){var a=!1;return parseInt(t.length)==parseInt(0)&&(a=!0),a},is_Mobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return is_Mobile.Android()||is_Mobile.BlackBerry()||is_Mobile.iOS()||is_Mobile.Opera()||is_Mobile.Windows()}};